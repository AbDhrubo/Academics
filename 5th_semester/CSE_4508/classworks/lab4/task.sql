-- Create Tables
CREATE TABLE BUS (
    BUS_ID NUMBER PRIMARY KEY,
    BUS_MODEL VARCHAR2(50),
    MANUFACTURER VARCHAR2(50)
);

CREATE TABLE DRIVER (
    DRIVER_ID NUMBER PRIMARY KEY,
    DRIVER_NAME VARCHAR2(100)
);

CREATE TABLE DEPOT (
    DEPOT_ID NUMBER PRIMARY KEY,
    DEPOT_NAME VARCHAR2(100),
    CITY VARCHAR2(100)
);

CREATE TABLE TIME_DIM (
    TIME_ID NUMBER PRIMARY KEY,
    YEAR NUMBER,
    MONTH NUMBER,
    DAY NUMBER
);

CREATE TABLE TRIP (
    TRIP_ID NUMBER PRIMARY KEY,
    SEGMENT_ID NUMBER,
    BUS_ID NUMBER,
    DRIVER_ID NUMBER,
    DEPOT_ID NUMBER,
    TRIP_DATE DATE,
    KILOMETERS_TRAVELED NUMBER,
    FUEL_CONSUMPTION NUMBER,
    PASSENGERS_COUNT NUMBER,
    TRIP_DURATION NUMBER,
    FOREIGN KEY (BUS_ID) REFERENCES BUS(BUS_ID),
    FOREIGN KEY (DRIVER_ID) REFERENCES DRIVER(DRIVER_ID),
    FOREIGN KEY (DEPOT_ID) REFERENCES DEPOT(DEPOT_ID)
);

-- Insert Data into Bus Table
INSERT INTO BUS VALUES (
    1,
    'Model A',
    'Manufacturer X'
);

INSERT INTO BUS VALUES (
    2,
    'Model B',
    'Manufacturer Y'
);

INSERT INTO BUS VALUES (
    3,
    'Model C',
    'Manufacturer Z'
);

INSERT INTO BUS VALUES (
    4,
    'Model D',
    'Manufacturer X'
);

-- Insert Data into Driver Table
INSERT INTO DRIVER VALUES (
    1,
    'John Doe'
);

INSERT INTO DRIVER VALUES (
    2,
    'Jane Smith'
);

INSERT INTO DRIVER VALUES (
    3,
    'Michael Brown'
);

INSERT INTO DRIVER VALUES (
    4,
    'Laura White'
);

-- Insert Data into Depot Table
INSERT INTO DEPOT VALUES (
    1,
    'Depot 1',
    'City A'
);

INSERT INTO DEPOT VALUES (
    2,
    'Depot 2',
    'City B'
);

INSERT INTO DEPOT VALUES (
    3,
    'Depot 3',
    'City C'
);

-- Insert Data into Time Dimension Table
INSERT INTO TIME_DIM VALUES (
    1,
    2023,
    10,
    1
);

INSERT INTO TIME_DIM VALUES (
    2,
    2023,
    10,
    2
);

INSERT INTO TIME_DIM VALUES (
    3,
    2023,
    10,
    3
);

INSERT INTO TIME_DIM VALUES (
    4,
    2023,
    11,
    1
);

INSERT INTO TIME_DIM VALUES (
    5,
    2023,
    11,
    2
);

-- Insert Data into Trip Table
INSERT INTO TRIP VALUES (
    1,
    1,
    1,
    1,
    1,
    TO_DATE('2023-10-01', 'YYYY-MM-DD'),
    100,
    50,
    20,
    180
);

INSERT INTO TRIP VALUES (
    2,
    1,
    2,
    2,
    2,
    TO_DATE('2023-10-02', 'YYYY-MM-DD'),
    200,
    75,
    30,
    240
);

INSERT INTO TRIP VALUES (
    3,
    2,
    1,
    1,
    1,
    TO_DATE('2023-10-03', 'YYYY-MM-DD'),
    150,
    60,
    25,
    200
);

INSERT INTO TRIP VALUES (
    4,
    2,
    3,
    3,
    2,
    TO_DATE('2023-11-01', 'YYYY-MM-DD'),
    300,
    100,
    40,
    360
);

INSERT INTO TRIP VALUES (
    5,
    3,
    4,
    4,
    3,
    TO_DATE('2023-11-02', 'YYYY-MM-DD'),
    250,
    80,
    35,
    320
);

INSERT INTO TRIP VALUES (
    6,
    3,
    2,
    1,
    1,
    TO_DATE('2023-10-01', 'YYYY-MM-DD'),
    220,
    90,
    50,
    300
);

INSERT INTO TRIP VALUES (
    7,
    2,
    3,
    2,
    2,
    TO_DATE('2023-10-02', 'YYYY-MM-DD'),
    180,
    70,
    45,
    270
);

INSERT INTO TRIP VALUES (
    8,
    1,
    4,
    4,
    3,
    TO_DATE('2023-10-03', 'YYYY-MM-DD'),
    320,
    120,
    55,
    400
);

-- task 1
SELECT
    BUS_ID,
    EXTRACT(YEAR FROM TRIP_DATE)  AS YEAR,
    EXTRACT(MONTH FROM TRIP_DATE) AS MONTH,
    EXTRACT(DAY FROM TRIP_DATE)   AS DAY,
    SUM(KILOMETERS_TRAVELED)      AS TOTAL_KILOMETERS_TRAVELED,
    SUM(FUEL_CONSUMPTION)         AS TOTAL_FUEL_CONSUMPTION,
    SUM(PASSENGERS_COUNT)         AS TOTAL_PASSENGERS_COUNT
FROM
    TRIP
GROUP BY
    ROLLUP(BUS_ID, EXTRACT(YEAR FROM TRIP_DATE), EXTRACT(MONTH FROM TRIP_DATE), EXTRACT(DAY FROM TRIP_DATE));

-- task 2
SELECT
    BUS_MODEL,
    EXTRACT(YEAR FROM TRIP_DATE)  AS YEAR,
    EXTRACT(MONTH FROM TRIP_DATE) AS MONTH,
    SUM(KILOMETERS_TRAVELED)      AS TOTAL_KILOMETERS_TRAVELED,
    SUM(FUEL_CONSUMPTION)         AS TOTAL_FUEL_CONSUMPTION,
    SUM(PASSENGERS_COUNT)         AS TOTAL_PASSENGERS_COUNT
FROM
    TRIP
    INNER JOIN BUS
    ON TRIP.BUS_ID = BUS.BUS_ID
GROUP BY
    ROLLUP(BUS_MODEL, EXTRACT(YEAR FROM TRIP_DATE), EXTRACT(MONTH FROM TRIP_DATE));

-- task 3

SELECT
    BUS_MODEL,
    DEPOT_NAME,
    EXTRACT(YEAR FROM TRIP_DATE)  AS YEAR,
    EXTRACT(MONTH FROM TRIP_DATE) AS MONTH,
    SUM(KILOMETERS_TRAVELED)      AS TOTAL_KILOMETERS_TRAVELED,
    SUM(FUEL_CONSUMPTION)         AS TOTAL_FUEL_CONSUMPTION,
    SUM(PASSENGERS_COUNT)         AS TOTAL_PASSENGERS_COUNT
FROM
    TRIP
    INNER JOIN BUS
    ON TRIP.BUS_ID = BUS.BUS_ID
    INNER JOIN DEPOT
    ON DEPOT.DEPOT_ID = TRIP.DEPOT_ID
GROUP BY
    CUBE(BUS.BUS_MODEL, DEPOT_ID, EXTRACT(YEAR FROM TRIP_DATE));

-- task 4
SELECT
    BUS_MODEL,
    EXTRACT(YEAR FROM TRIP_DATE)            AS YEAR,
    EXTRACT(MONTH FROM TRIP_DATE)           AS MONTH,
    SUM(KILOMETERS_TRAVELED)                AS TOTAL_KILOMETERS_TRAVELED,
    SUM(FUEL_CONSUMPTION)                   AS TOTAL_FUEL_CONSUMPTION,
    SUM(PASSENGERS_COUNT)                   AS TOTAL_PASSENGERS_COUNT,
    GROUPING(BUS_MODEL)                     AS BUS_MODEL_GROUP,
    GROUPING(EXTRACT(YEAR FROM TRIP_DATE))  AS YEAR_GROUP,
    GROUPING(EXTRACT(MONTH FROM TRIP_DATE)) AS MONTH_GROUP
FROM
    TRIP
    INNER JOIN BUS
    ON TRIP.BUS_ID = BUS.BUS_ID
GROUP BY
    ROLLUP(BUS_MODEL, EXTRACT(YEAR FROM TRIP_DATE), EXTRACT(MONTH FROM TRIP_DATE));

-- task 5
SELECT
    BUS_MODEL,
    DEPOT_ID,
    EXTRACT(YEAR FROM TRIP_DATE) AS YEAR,
    SUM(KILOMETERS_TRAVELED)     AS TOTAL_KILOMETERS_TRAVELED,
    SUM(FUEL_CONSUMPTION)        AS TOTAL_FUEL_CONSUMPTION,
    SUM(PASSENGERS_COUNT)        AS TOTAL_PASSENGERS_COUNT
FROM
    TRIP
    INNER JOIN BUS
    ON TRIP.BUS_ID = BUS.BUS_ID
GROUP BY
    ROLLUP(BUS_MODEL, DEPOT_ID, EXTRACT(YEAR FROM TRIP_DATE));