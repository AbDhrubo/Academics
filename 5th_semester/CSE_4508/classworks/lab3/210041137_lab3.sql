-- task 1

CREATE TABLE CUSTOMERS (
    CUSTOMER_ID NUMBER PRIMARY KEY,
    CUSTOMER_NAME VARCHAR2(100),
    DATE_OF_BIRTH DATE,
    ADDRESS_ID NUMBER,
    SUBSCRIPTION_ID NUMBER
);

CREATE TABLE ADDRESSES (
    ADDRESS_ID NUMBER PRIMARY KEY,
    DIVISION VARCHAR2(50),
    DISTRICT VARCHAR2(50)
);

CREATE TABLE SUBSCRIPTIONS (
    SUBSCRIPTION_ID NUMBER PRIMARY KEY,
    SUBSCRIBER_TYPE VARCHAR2(10),
    SUBSCRIBER_LEVEL VARCHAR2(10),
    LIFETIME_USAGE NUMBER
);

INSERT INTO ADDRESSES VALUES (
    1,
    'Dhaka',
    'Dhaka'
);

INSERT INTO ADDRESSES VALUES (
    2,
    'Khulna',
    'Jessore'
);

INSERT INTO ADDRESSES VALUES (
    3,
    'Chittagong',
    'Comilla'
);

INSERT INTO ADDRESSES VALUES (
    4,
    'Dhaka',
    'Gazipur'
);

INSERT INTO ADDRESSES VALUES (
    5,
    'Sylhet',
    'Sylhet'
);

INSERT INTO SUBSCRIPTIONS VALUES (
    1,
    'Prepaid',
    'Silver',
    5000
);

INSERT INTO SUBSCRIPTIONS VALUES (
    2,
    'Postpaid',
    'Gold',
    20000
);

INSERT INTO SUBSCRIPTIONS VALUES (
    3,
    'Prepaid',
    'Bronze',
    3000
);

INSERT INTO SUBSCRIPTIONS VALUES (
    4,
    'Postpaid',
    'Platinum',
    40000
);

INSERT INTO SUBSCRIPTIONS VALUES (
    5,
    'Prepaid',
    'Silver',
    7000
);

INSERT INTO CUSTOMERS VALUES (
    1,
    '  john Doe',
    TO_DATE('1990-05-10', 'YYYY-MM-DD'),
    1,
    1
);

INSERT INTO CUSTOMERS VALUES (
    2,
    'Jane smith  ',
    TO_DATE('1985-12-25', 'YYYY-MM-DD'),
    2,
    2
);

INSERT INTO CUSTOMERS VALUES (
    3,
    'ahmed khan',
    TO_DATE('1975-07-15', 'YYYY-MM-DD'),
    3,
    3
);

INSERT INTO CUSTOMERS VALUES (
    4,
    'lisa Rahman',
    TO_DATE('1992-03-09', 'YYYY-MM-DD'),
    4,
    4
);

INSERT INTO CUSTOMERS VALUES (
    5,
    'Samiul Islam',
    TO_DATE('1988-11-19', 'YYYY-MM-DD'),
    5,
    5
);

-- task 2
SELECT
    C.CUSTOMER_NAME,
    C.CUSTOMER_ID,
    S.LIFETIME_USAGE
FROM
    CUSTOMERS     C
    INNER JOIN SUBSCRIPTIONS S
    ON C.SUBSCRIPTION_ID = S.SUBSCRIPTION_ID
ORDER BY
    S.LIFETIME_USAGE DESC;

WHERE
ROWNUM <= 5;

-- task 3
SELECT
    C.CUSTOMER_NAME,
    C.DATE_OF_BIRTH,
    A.DISTRICT,
    A.DIVISION
FROM
    CUSTOMERS     C
    INNER JOIN SUBSCRIPTIONS S
    ON C.SUBSCRIPTION_ID = S.SUBSCRIPTION_ID
    INNER JOIN ADDRESSES A
    ON C.ADDRESS_ID = A.ADDRESS_ID
WHERE
    S.LIFETIME_USAGE > (
        SELECT
            AVG(LIFETIME_USAGE)
        FROM
            SUBSCRIPTIONS
        WHERE
            SUBSCRIBER_TYPE = 'Prepaid'
            AND SUBSCRIBER_LEVEL = 'Silver'
    );

-- task 4
SELECT
    COUNT(C.CUSTOMER_ID) AS TOTAL_CUSTOMERS
FROM
    CUSTOMERS     C
    INNER JOIN SUBSCRIPTIONS S
    ON C.SUBSCRIPTION_ID = S.SUBSCRIPTION_ID
    INNER JOIN ADDRESSES A
    ON C.ADDRESS_ID = A.ADDRESS_ID
WHERE
    A.DIVISION = 'Dhaka'
    AND S.LIFETIME_USAGE > (
        SELECT
            AVG(LIFETIME_USAGE)
        FROM
            SUBSCRIPTIONS
        WHERE
            SUBSCRIBER_TYPE = 'Prepaid'
            AND SUBSCRIBER_LEVEL = 'Silver'
    );

-- task 5
SELECT
    CONCAT('Mr. ', CUSTOMER_NAME) AS NAMES
FROM
    CUSTOMERS;

-- task 6
SELECT
    INITCAP(CUSTOMER_NAME) AS NAMES
FROM
    CUSTOMERS;

-- task 7
SELECT
    CUSTOMER_NAME,
    INSTR(CUSTOMER_NAME, 'an')
FROM
    CUSTOMERS
WHERE
    INSTR(CUSTOMER_NAME, 'an') != 0;

--task 8
SELECT
    LOWER(CUSTOMER_NAME) AS LOWER_CASE_NAMES
FROM
    CUSTOMERS;

-- task 9
SELECT
    UPPER(CUSTOMER_NAME) AS UPPER_CASE_NAMES
FROM
    CUSTOMERS;

-- task 10
SELECT
    CUSTOMER_NAME,
    LENGTH(CUSTOMER_NAME) AS NAME_LENGTH
FROM
    CUSTOMERS;

-- task 11
SELECT
    LPAD(CUSTOMER_NAME, 15, '*') AS CUSTOMER_NAME
FROM
    CUSTOMERS;

-- task 12
SELECT
    LTRIM(CUSTOMER_NAME) AS CUSTOMER_NAME
FROM
    CUSTOMERS;

-- task 13
SELECT
    SUBSTR(CUSTOMER_NAME, 1, 5) AS CUSTOMER_NAME
FROM
    CUSTOMERS;

-- task 14
SELECT
    A.DIVISION,
    COUNT(C.CUSTOMER_NAME) AS NUMBER_OF_CUSTOMERS
FROM
    CUSTOMERS C
    INNER JOIN ADDRESSES A
    ON C.ADDRESS_ID = A.ADDRESS_ID
GROUP BY
    A.DIVISION;